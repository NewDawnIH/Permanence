<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MariusDoc</title>
</head>
<body style="margin: 0; padding: 0; background-color: transparent; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">

<div id="marius-doc-app" style="width: 100%; min-height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; background-color: #0a0a0a; color: #e0e0e0;">
    
    <!-- HEADER -->
    <header id="app-header" style="height: 60px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; flex-shrink: 0; background-color: #0a0a0a;">
        <div style="display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="app.navigate('projects')">
            <div id="logo-square" style="width: 20px; height: 20px; background: #00ff9d; transform: rotate(45deg);"></div>
            <h1 style="font-size: 18px; margin: 0; font-weight: 800; letter-spacing: 1px;">Marius<span id="logo-accent" style="color: #00ff9d;">Doc</span></h1>
        </div>
        <div style="display: flex; gap: 10px;">
            <button id="theme-toggle" style="background: transparent; border: 1px solid #333; color: #e0e0e0; padding: 8px 16px; cursor: pointer; border-radius: 4px; font-size: 13px; font-weight: 500;" onclick="app.toggleTheme()">☀/☾</button>
        </div>
    </header>

    <div style="display: flex; flex: 1; overflow: hidden;">
        <!-- SIDEBAR -->
        <aside id="app-sidebar" style="width: 200px; border-right: 1px solid #333; padding-top: 20px; flex-shrink: 0; background-color: #0a0a0a;">
            <div id="nav-projects" style="padding: 12px 20px; cursor: pointer; border-left: 3px solid #00ff9d; color: #00ff9d; background: rgba(0, 255, 157, 0.1); transition: 0.2s;" onclick="app.navigate('projects')">Projects</div>
            <div id="nav-config" style="padding: 12px 20px; cursor: pointer; border-left: 3px solid transparent; color: #888; transition: 0.2s;" onclick="app.navigate('config')">Configuration</div>
        </aside>

        <!-- MAIN VIEW -->
        <main id="main-content" style="flex: 1; overflow-y: auto; background-color: #0a0a0a;">
            <!-- Content injected here -->
        </main>
    </div>

    <!-- MODAL CONTAINER -->
    <div id="modal-container" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(2px);">
        <!-- Modal content injected here -->
    </div>
</div>

<script>
    var app = {
        data: {
            projects: [],
            config: { themeColor: '#00ff9d' }
        },
        currentView: 'projects',
        currentProjectId: null,
        theme: 'dark',
        archiveFilter: '',
        statuses: ['PREP', 'DEV', 'APB', 'FEA', 'DOR', 'DOD', 'DONE'],
        statusColors: {
            DONE: '#00ff9d', DEV: '#3b82f6', PREP: '#a855f7', FEA: '#6366f1', APB: '#f59e0b', DOR: '#64748b', DOD: '#ef4444'
        },

        getBtnStyle: function(isPrimary) {
            var base = "padding: 8px 16px; cursor: pointer; border-radius: 4px; font-size: 12px; font-weight: bold; border: 1px solid ";
            if (isPrimary) {
                return base + this.data.config.themeColor + "; background: " + this.data.config.themeColor + "; color: #000;";
            }
            return base + (this.theme === 'dark' ? "#333" : "#ccc") + "; background: transparent; color: " + (this.theme === 'dark' ? "#e0e0e0" : "#1a1a1a") + ";";
        },

        getInputStyle: function() {
            return "background: " + (this.theme === 'dark' ? "#0a0a0a" : "#fff") + "; border: 1px solid " + (this.theme === 'dark' ? "#333" : "#ddd") + "; color: " + (this.theme === 'dark' ? "#e0e0e0" : "#1a1a1a") + "; padding: 8px; border-radius: 4px; width: 100%; margin-bottom: 8px; font-family: inherit; box-sizing: border-box; font-size: 12px;";
        },

        init: function() {
            this.render();
        },

        navigate: function(view) {
            this.currentView = view;
            this.currentProjectId = null;
            this.render();
        },

        toggleTheme: function() {
            this.theme = this.theme === 'dark' ? 'light' : 'dark';
            var root = document.getElementById('marius-doc-app');
            var header = document.getElementById('app-header');
            var sidebar = document.getElementById('app-sidebar');
            var main = document.getElementById('main-content');
            
            if (this.theme === 'light') {
                root.style.backgroundColor = '#fff'; root.style.color = '#1a1a1a';
                header.style.backgroundColor = '#f8f9fa'; header.style.borderBottomColor = '#eee';
                sidebar.style.backgroundColor = '#f8f9fa'; sidebar.style.borderRightColor = '#eee';
                main.style.backgroundColor = '#fff';
            } else {
                root.style.backgroundColor = '#0a0a0a'; root.style.color = '#e0e0e0';
                header.style.backgroundColor = '#0a0a0a'; header.style.borderBottomColor = '#333';
                sidebar.style.backgroundColor = '#0a0a0a'; sidebar.style.borderRightColor = '#333';
                main.style.backgroundColor = '#0a0a0a';
            }
            this.render();
        },

        render: function() {
            var container = document.getElementById('main-content');
            var navP = document.getElementById('nav-projects');
            var navC = document.getElementById('nav-config');
            var themeAcc = this.data.config.themeColor;
            
            navP.style.borderLeftColor = this.currentView === 'projects' ? themeAcc : 'transparent';
            navP.style.color = this.currentView === 'projects' ? themeAcc : (this.theme === 'dark' ? '#888' : '#666');
            navP.style.background = this.currentView === 'projects' ? 'rgba(0,255,157,0.1)' : 'transparent';
            
            navC.style.borderLeftColor = this.currentView === 'config' ? themeAcc : 'transparent';
            navC.style.color = this.currentView === 'config' ? themeAcc : (this.theme === 'dark' ? '#888' : '#666');
            navC.style.background = this.currentView === 'config' ? 'rgba(0,255,157,0.1)' : 'transparent';

            container.innerHTML = '';
            if (this.currentProjectId) {
                this.renderDetail(container);
            } else if (this.currentView === 'projects') {
                this.renderDashboard(container);
            } else {
                this.renderConfig(container);
            }
        },

        renderDashboard: function(container) {
            var projects = this.data.projects || [];
            var allTodos = [];
            var activeProjects = [];
            var doneProjects = [];

            for (var i = 0; i < projects.length; i++) {
                if (projects[i].status === 'DONE') {
                    doneProjects.push(projects[i]);
                } else {
                    activeProjects.push(projects[i]);
                }

                if (projects[i].todos) {
                    for (var t = 0; t < projects[i].todos.length; t++) {
                        if (!projects[i].todos[t].done) {
                            allTodos.push({
                                projectId: projects[i].id,
                                projectName: projects[i].name,
                                todo: projects[i].todos[t],
                                todoIndex: t
                            });
                        }
                    }
                }
            }

            var html = '<div style="padding: 20px;">';
            if (allTodos.length > 0) {
                html += '<div style="margin-bottom: 30px; background: ' + (this.theme === 'dark' ? '#111' : '#f0fdf4') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#bbf7d0') + '; border-radius: 8px; padding: 16px;">' +
                        '<h3 style="margin: 0 0 12px 0; font-size: 14px; color: ' + this.data.config.themeColor + '; text-transform: uppercase; letter-spacing: 1px;">Global To-Do List</h3>' +
                        '<div style="display: flex; flex-direction: column; gap: 8px;">';
                for (var j = 0; j < allTodos.length; j++) {
                    var item = allTodos[j];
                    html += '<div style="display: flex; align-items: center; gap: 10px; font-size: 13px; background: ' + (this.theme === 'dark' ? '#0a0a0a' : '#fff') + '; padding: 8px; border-radius: 4px; border: 1px solid ' + (this.theme === 'dark' ? '#222' : '#eee') + ';">' +
                            '<input type="checkbox" style="cursor: pointer;" onclick="app.toggleTodo(' + item.projectId + ',' + item.todoIndex + ')">' +
                            '<span style="flex: 1;">' + item.todo.text + '</span>' +
                            '<span style="font-size: 10px; color: #888; background: ' + (this.theme === 'dark' ? '#222' : '#eee') + '; padding: 2px 6px; border-radius: 10px; cursor: pointer;" onclick="app.openProject(' + item.projectId + ')">' + item.projectName + '</span>' +
                            '</div>';
                }
                html += '</div></div>';
            }

            html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">' +
                       '<h2 style="margin:0">Active Projects</h2>' +
                       '<button style="' + this.getBtnStyle(true) + '" onclick="app.openModal(\'new-project\')">+ New Project</button>' +
                       '</div>';

            if (activeProjects.length === 0) {
                html += '<div style="padding: 40px; text-align: center; color: #666; border: 1px dashed #444; border-radius: 8px; margin-bottom: 40px;">No active projects.</div>';
            } else {
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-bottom: 40px;">';
                for (var i = 0; i < activeProjects.length; i++) {
                    var p = activeProjects[i];
                    var statusCol = this.statusColors[p.status] || '#333';
                    var pendingCount = (p.todos || []).filter(t => !t.done).length;
                    html += '<div style="background: ' + (this.theme === 'dark' ? '#111' : '#f9f9f9') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#eee') + '; border-left: 4px solid ' + statusCol + '; border-radius: 6px; padding: 16px; cursor: pointer; position: relative;" onclick="app.openProject(' + p.id + ')">' +
                            (pendingCount > 0 ? '<div style="position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; border: 2px solid ' + (this.theme === 'dark' ? '#0a0a0a' : '#fff') + '">' + pendingCount + '</div>' : '') +
                            '<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">' +
                            '<span style="font-weight: bold;">' + p.name + '</span>' +
                            '<span style="font-size: 10px; padding: 2px 6px; border-radius: 4px; background:' + statusCol + '; color:#000; font-weight:bold;">' + p.status + '</span>' +
                            '</div>' +
                            '<div style="font-size: 12px; color: #888; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">' + (p.intro || 'No description.') + '</div>' +
                            '</div>';
                }
                html += '</div>';
            }

            if (doneProjects.length > 0) {
                html += '<div style="margin-top: 60px;">' +
                        '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px;">' +
                        '<h2 style="margin:0; font-size: 20px;">Completed Projects Archive</h2>' +
                        '<input type="text" placeholder="Filter archive..." value="' + (this.archiveFilter || '') + '" oninput="app.archiveFilter = this.value; app.render();" style="' + this.getInputStyle() + ' width: 200px; margin-bottom: 0;">' +
                        '</div>';
                html += '<div style="overflow-x: auto;">' +
                        '<table style="width: 100%; border-collapse: collapse; font-size: 13px;">' +
                        '<thead style="background: ' + (this.theme === 'dark' ? '#111' : '#f8f9fa') + '; border-bottom: 2px solid #333;">' +
                        '<tr>' +
                        '<th style="text-align: left; padding: 12px; color: #888;">Project Title</th>' +
                        '<th style="text-align: left; padding: 12px; color: #888;">Description</th>' +
                        '<th style="text-align: left; padding: 12px; color: #888; width: 160px;">Last Activity</th>' +
                        '</tr>' +
                        '</thead>' +
                        '<tbody>';
                var filteredArchive = doneProjects.filter(p => {
                    if (!this.archiveFilter) return true;
                    var term = this.archiveFilter.toLowerCase();
                    return p.name.toLowerCase().includes(term) || (p.intro && p.intro.toLowerCase().includes(term));
                });
                for (var k = 0; k < filteredArchive.length; k++) {
                    var ap = filteredArchive[k];
                    var lastLog = (ap.logs && ap.logs.length > 0) ? ap.logs[ap.logs.length-1].date : 'N/A';
                    html += '<tr style="border-bottom: 1px solid #222; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background=\'rgba(255,255,255,0.03)\'" onmouseout="this.style.background=\'transparent\'" onclick="app.openProject(' + ap.id + ')">' +
                            '<td style="padding: 12px; font-weight: bold; color: ' + this.data.config.themeColor + ';">' + ap.name + '</td>' +
                            '<td style="padding: 12px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 400px;">' + (ap.intro || '—') + '</td>' +
                            '<td style="padding: 12px; color: #666; font-size: 11px;">' + lastLog + '</td>' +
                            '</tr>';
                }
                if (filteredArchive.length === 0) {
                    html += '<tr><td colspan="3" style="padding: 20px; text-align: center; color: #555;">No archived projects match your filter.</td></tr>';
                }
                html += '</tbody></table></div></div>';
            }
            html += '</div>';
            container.innerHTML = html;
        },

        renderDetail: function(container) {
            var p = null;
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) p = this.data.projects[i];
            }
            if (!p) return;

            var html = '<div style="padding: 20px;">' +
                       '<button style="' + this.getBtnStyle(false) + ' margin-bottom: 20px;" onclick="app.navigate(\'projects\')">← Back</button>' +
                       '<div style="display: flex; gap: 30px; align-items: flex-start;">' +
                       '<div style="flex: 1;">' +
                       '<h2 style="margin: 0 0 15px 0; color: ' + this.data.config.themeColor + '">' + p.name + '</h2>' +
                       '<div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">' +
                       '<label style="font-size: 11px; color: #888; font-weight: bold;">STATUS:</label>' +
                       '<select onchange="app.updateProjectField(\'status\', this.value)" style="background:' + (this.statusColors[p.status] || '#333') + '; color:#000; border:none; padding: 4px 8px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 11px;">';
            for(var s=0; s<this.statuses.length; s++) {
                var sel = this.statuses[s] === p.status ? ' selected' : '';
                html += '<option value="' + this.statuses[s] + '"' + sel + '>' + this.statuses[s] + '</option>';
            }
            html += '</select></div>' +
                       '<div style="margin-bottom: 30px; background: ' + (this.theme === 'dark' ? '#111' : '#f9f9f9') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#eee') + '; border-radius: 8px; padding: 16px;">' +
                       '<h4 style="margin: 0 0 12px 0; font-size: 12px; color: #888; text-transform: uppercase;">To-Dos</h4>' +
                       '<div style="display: flex; gap: 8px; margin-bottom: 12px;">' +
                       '<input id="todo-in" style="' + this.getInputStyle() + ' margin-bottom: 0;" placeholder="Add a task..." onkeydown="if(event.key===\'Enter\')app.addTodo()">' +
                       '<button style="' + this.getBtnStyle(true) + ' padding: 0 12px;" onclick="app.addTodo()">+</button>' +
                       '</div>' +
                       '<div id="todo-list" style="display: flex; flex-direction: column; gap: 6px;">';
            var todos = p.todos || [];
            if (todos.length === 0) {
                html += '<span style="font-size: 12px; color: #666; font-style: italic;">No tasks yet.</span>';
            } else {
                for (var t = 0; t < todos.length; t++) {
                    var todo = todos[t];
                    html += '<div style="display: flex; align-items: center; gap: 10px; font-size: 13px;">' +
                            '<input type="checkbox" ' + (todo.done ? 'checked' : '') + ' onclick="app.toggleTodo(' + p.id + ',' + t + ')" style="cursor: pointer;">' +
                            '<span style="' + (todo.done ? 'text-decoration: line-through; color: #666;' : '') + '">' + todo.text + '</span>' +
                            '<span style="margin-left: auto; color: #ef4444; cursor: pointer; font-size: 14px;" onclick="app.removeTodo(' + t + ')">×</span>' +
                            '</div>';
                }
            }
            html += '</div></div>' +
                       '<div style="margin-bottom: 30px;">' +
                       '<label style="display: block; font-size: 11px; color: #888; font-weight: bold; margin-bottom: 5px;">PROJECT INTRO / DESCRIPTION</label>' +
                       '<textarea onblur="app.updateProjectField(\'intro\', this.value)" style="' + this.getInputStyle() + ' height: 80px; margin-bottom: 0; line-height: 1.5; resize: vertical;">' + (p.intro || '') + '</textarea>' +
                       '</div>' +
                       '<h3 style="border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 15px;">Activity Logs</h3>' +
                       '<div id="logs-list" style="margin-bottom: 20px;">';
            if (!p.logs || p.logs.length === 0) {
                html += '<p style="font-size: 12px; color: #666;">No logs available.</p>';
            } else {
                for (var j = p.logs.length - 1; j >= 0; j--) {
                    html += '<div style="border-bottom: 1px solid #222; padding: 12px 0;">' +
                            '<div style="font-size: 10px; color: ' + this.data.config.themeColor + '; margin-bottom: 4px;">' + p.logs[j].date + '</div>' +
                            '<div style="font-size: 13px; line-height: 1.5; white-space: pre-wrap;">' + p.logs[j].text + '</div>' +
                            '</div>';
                }
            }
            html += '</div>' +
                    '<textarea id="log-input" style="' + this.getInputStyle() + ' height: 80px;" placeholder="Post a new update..."></textarea>' +
                    '<div style="text-align: right;"><button style="' + this.getBtnStyle(true) + '" onclick="app.addLog()">Post Update</button></div>' +
                    '</div>';

            // RESOURCES
            html += '<div style="width: 320px; display: flex; flex-direction: column; gap: 20px;">' +
                    '<div style="background: ' + (this.theme === 'dark' ? '#111' : '#f9f9f9') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#eee') + '; padding: 16px; border-radius: 8px;">' +
                    '<h4 style="margin: 0 0 15px 0; text-transform: uppercase; font-size: 11px; color: #888; letter-spacing: 1px;">Resources</h4>' +
                    this.renderResInput('Programs', 'prog-in', 'programs', p) +
                    this.renderResInput('Tables', 'table-in', 'tables', p) +
                    this.renderResInput('Jira Link / Ticket', 'jira-in', 'jira', p) +
                    '</div>' +
                    '</div>';

            html += '</div></div>';
            container.innerHTML = html;
        },

        renderResInput: function(label, id, type, p) {
            var items = p[type] || [];
            var html = '<div style="margin-bottom: 20px;">' +
                       '<label style="display: block; font-size: 11px; color: #888; font-weight: bold; margin-bottom: 5px;">' + label + '</label>' +
                       '<input id="' + id + '" style="' + this.getInputStyle() + '" placeholder="Enter ' + label + '..." onkeydown="if(event.key===\'Enter\')app.addRes(\'' + type + '\')">' +
                       '<div>';
            for(var i=0; i<items.length; i++) {
                html += '<div style="font-size: 12px; color: #e0e0e0; background: #222; padding: 6px 8px; border-radius: 4px; margin-bottom: 4px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; word-break: break-all;">' + 
                        '<span style="flex: 1; padding-right: 10px;">' + items[i] + '</span>' + 
                        '<span style="color:#ef4444; cursor:pointer; font-size: 14px; font-weight: bold;" onclick="app.delRes(\'' + type + '\',' + i + ')">×</span>' +
                        '</div>';
            }
            html += '</div></div>';
            return html;
        },

        renderConfig: function(container) {
            var b64 = btoa(JSON.stringify(this.data));
            var html = '<div style="padding: 20px; max-width: 600px;">' +
                       '<h2>Configuration</h2>' +
                       '<div style="background: ' + (this.theme === 'dark' ? '#111' : '#f9f9f9') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#eee') + '; padding: 20px; border-radius: 8px;">' +
                       '<label style="display: block; font-size: 11px; color: #888; font-weight: bold; margin-bottom: 10px;">THEME ACCENT COLOR</label>' +
                       '<input type="color" style="width: 60px; height: 30px; border: none; background: transparent; cursor: pointer; margin-bottom: 20px;" value="' + this.data.config.themeColor + '" oninput="app.data.config.themeColor = this.value; app.render();">' +
                       '<label style="display: block; font-size: 11px; color: #888; font-weight: bold; margin-bottom: 10px;">SESSION DATA (BACKUP)</label>' +
                       '<textarea readonly style="' + this.getInputStyle() + ' height: 80px; font-size: 10px; color: ' + this.data.config.themeColor + ';">' + b64 + '</textarea>' +
                       '<label style="display: block; font-size: 11px; color: #888; font-weight: bold; margin: 20px 0 10px 0;">IMPORT DATA</label>' +
                       '<textarea id="import-area" style="' + this.getInputStyle() + ' height: 60px;" placeholder="Paste string here..."></textarea>' +
                       '<button style="' + this.getBtnStyle(true) + ' width: 100%;" onclick="app.importData()">Restore Session</button>' +
                       '</div></div>';
            container.innerHTML = html;
        },

        updateProjectField: function(field, value) {
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    this.data.projects[i][field] = value;
                }
            }
            this.render();
        },

        addTodo: function() {
            var txt = document.getElementById('todo-in').value;
            if (!txt) return;
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    if(!this.data.projects[i].todos) this.data.projects[i].todos = [];
                    this.data.projects[i].todos.push({ text: txt, done: false });
                }
            }
            this.render();
        },

        toggleTodo: function(projId, index) {
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === projId) {
                    this.data.projects[i].todos[index].done = !this.data.projects[i].todos[index].done;
                }
            }
            this.render();
        },

        removeTodo: function(index) {
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    this.data.projects[i].todos.splice(index, 1);
                }
            }
            this.render();
        },

        openProject: function(id) {
            this.currentProjectId = id;
            this.currentView = 'projects';
            this.render();
        },

        addLog: function() {
            var txt = document.getElementById('log-input').value;
            if (!txt) return;
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    if(!this.data.projects[i].logs) this.data.projects[i].logs = [];
                    this.data.projects[i].logs.push({ date: new Date().toLocaleString(), text: txt });
                }
            }
            this.render();
        },

        addRes: function(type) {
            var map = { jira: 'jira-in', programs: 'prog-in', tables: 'table-in' };
            var val = document.getElementById(map[type]).value;
            if (!val) return;
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    if(!this.data.projects[i][type]) this.data.projects[i][type] = [];
                    this.data.projects[i][type].push(val);
                }
            }
            this.render();
        },

        delRes: function(type, idx) {
            for(var i=0; i<this.data.projects.length; i++) {
                if(this.data.projects[i].id === this.currentProjectId) {
                    this.data.projects[i][type].splice(idx, 1);
                }
            }
            this.render();
        },

        importData: function() {
            var str = document.getElementById('import-area').value;
            if (!str) return;
            try {
                this.data = JSON.parse(atob(str.trim()));
                this.render();
            } catch(e) { console.error(e); }
        },

        openModal: function(type) {
            var modal = document.getElementById('modal-container');
            modal.style.display = 'flex';
            var html = '<div style="background: ' + (this.theme === 'dark' ? '#111' : '#fff') + '; border: 1px solid ' + (this.theme === 'dark' ? '#333' : '#ddd') + '; width: 400px; padding: 24px; border-radius: 8px;">';
            if (type === 'new-project') {
                html += '<h3 style="margin-top: 0;">New Project</h3>' +
                        '<label style="font-size: 11px; font-weight: bold; color: #888;">TITLE</label>' +
                        '<input id="m-name" style="' + this.getInputStyle() + '" placeholder="Enter name...">' +
                        '<label style="font-size: 11px; font-weight: bold; color: #888;">STATUS</label>' +
                        '<select id="m-status" style="' + this.getInputStyle() + '">';
                for(var i=0; i<this.statuses.length; i++) { html += '<option value="' + this.statuses[i] + '">' + this.statuses[i] + '</option>'; }
                html += '</select>' +
                        '<label style="font-size: 11px; font-weight: bold; color: #888;">INTRO</label>' +
                        '<textarea id="m-intro" style="' + this.getInputStyle() + ' height: 60px;"></textarea>' +
                        '<div style="display: flex; gap: 10px; margin-top: 10px;">' +
                        '<button style="' + this.getBtnStyle(true) + ' flex: 1;" onclick="app.saveNewProject()">Create</button>' +
                        '<button style="' + this.getBtnStyle(false) + ' flex: 1;" onclick="app.closeModal()">Cancel</button>' +
                        '</div>';
            }
            html += '</div>';
            modal.innerHTML = html;
        },

        saveNewProject: function() {
            var name = document.getElementById('m-name').value;
            if (!name) return;
            this.data.projects.push({
                id: Date.now(),
                name: name,
                status: document.getElementById('m-status').value,
                intro: document.getElementById('m-intro').value,
                logs: [], jira: [], programs: [], tables: [], todos: []
            });
            this.closeModal();
            this.render();
        },

        closeModal: function() { document.getElementById('modal-container').style.display = 'none'; }
    };

    window.onload = function() { app.init(); };
</script>
</body>
</html>
