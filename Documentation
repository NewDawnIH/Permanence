<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDock</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f5f5f5; color: #333; display: flex; height: 100vh; overflow: hidden;">

    <!-- SIDE NAVIGATION -->
    <nav id="sidebar" style="width: 260px; background-color: #ffffff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; flex-shrink: 0; box-shadow: 2px 0 5px rgba(0,0,0,0.05); z-index: 10;">
        <div style="padding: 24px; border-bottom: 1px solid #f0f0f0;">
            <h1 style="margin: 0; font-size: 22px; color: #1a73e8; letter-spacing: 0.5px; font-weight: 600;">MDock</h1>
        </div>
        <div style="flex-grow: 1; padding: 16px 0;">
            <div id="nav-projects" onclick="showTab('projects')" style="padding: 12px 24px; cursor: pointer; background-color: #e8f0fe; color: #1a73e8; font-weight: 500; display: flex; align-items: center; transition: background 0.2s;">
                <span style="margin-right: 12px;">üìÅ</span> Projects
            </div>
            <div id="nav-tables" onclick="showTab('tables')" style="padding: 12px 24px; cursor: pointer; color: #5f6368; font-weight: 500; display: flex; align-items: center; transition: background 0.2s;">
                <span style="margin-right: 12px;">üìä</span> Tables
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main id="main-content" style="flex-grow: 1; overflow-y: auto; position: relative;">
        
        <!-- PROJECTS TAB -->
        <div id="tab-projects" style="padding: 40px; max-width: 1000px; margin: 0 auto; display: block;">
            <!-- GLOBAL TODOS SECTION -->
            <div id="global-todos-container" style="margin-bottom: 40px; display: none;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <h4 style="margin: 0; font-size: 14px; color: #5f6368; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Pending To-Dos</h4>
                    <span id="overview-timestamp" style="font-size: 11px; color: #9aa0a6;"></span>
                </div>
                <div id="global-todo-list" style="display: flex; flex-direction: column; gap: 8px;"></div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                <h2 style="margin: 0; font-size: 28px; font-weight: 400;">Projects</h2>
                <button onclick="openNewProjectModal()" style="background-color: #1a73e8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: background 0.2s;">
                    + NEW PROJECT
                </button>
            </div>
            <div id="project-list" style="display: flex; flex-direction: column; gap: 16px;">
                <div id="empty-state" style="text-align: center; padding: 60px; color: #70757a; background: white; border-radius: 8px; border: 1px dashed #ccc;">
                    No projects found. Create your first project to get started.
                </div>
            </div>
        </div>

        <!-- PROJECT DETAIL VIEW -->
        <div id="tab-project-detail" style="padding: 40px; max-width: 1000px; margin: 0 auto; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <button onclick="showTab('projects')" style="background: none; border: none; color: #1a73e8; cursor: pointer; padding: 0; font-size: 14px; display: flex; align-items: center; font-weight: 500;">
                    ‚Üê Back to Projects
                </button>
                <h1 style="margin: 0; font-size: 18px; color: #5f6368; font-weight: 500;">Project Detail</h1>
            </div>
            <div style="background: white; border-radius: 8px; border: 1px solid #e0e0e0; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px; border-bottom: 1px solid #f1f3f4; padding-bottom: 24px;">
                    <div style="flex: 1;">
                        <h2 id="detail-name" style="margin: 0 0 12px 0; font-size: 32px; font-weight: 400;">Project Name</h2>
                        <div style="display: flex; align-items: flex-start; margin-top: 8px;">
                            <textarea id="detail-desc-input" oninput="saveDescriptionDirectly(this.value)" style="width: 100%; border: 1px solid #dadce0; border-radius: 4px; padding: 12px; font-family: inherit; font-size: 16px; color: #5f6368; line-height: 1.5; resize: vertical; min-height: 80px; box-sizing: border-box; background: #fff;" placeholder="Describe this project..."></textarea>
                        </div>
                    </div>
                    <div style="text-align: right; margin-left: 24px;">
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #70757a; margin-bottom: 8px;">PROJECT STATUS</label>
                        <select id="detail-status-select" onchange="updateProjectStatus(this.value)" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #dadce0; background: #fff; font-weight: 600; font-size: 13px; cursor: pointer;">
                            <option value="ANA">Analysis (ANA)</option>
                            <option value="DEV">Development (DEV)</option>
                            <option value="APB">Approval (APB)</option>
                            <option value="DONE">Done (DONE)</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 40px;">
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <h3 style="font-size: 18px; margin: 0; border-bottom: 2px solid #f1f3f4; padding-bottom: 8px;">Resources</h3>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #70757a; margin-bottom: 8px;">PROGRAMS</label>
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <input type="text" id="add-prog-input" placeholder="Program name..." style="flex: 1; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                                <button onclick="addResource('programs')" style="background: #f1f3f4; border: 1px solid #dadce0; padding: 0 12px; border-radius: 4px; cursor: pointer;">Add</button>
                            </div>
                            <div id="detail-programs-list" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; font-weight: 600; color: #70757a; margin-bottom: 8px;">TABLES</label>
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <input type="text" id="add-table-input" placeholder="Table name..." style="flex: 1; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                                <button onclick="addResource('tables')" style="background: #f1f3f4; border: 1px solid #dadce0; padding: 0 12px; border-radius: 4px; cursor: pointer;">Add</button>
                            </div>
                            <div id="detail-tables-list" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <h3 style="font-size: 18px; margin: 0; border-bottom: 2px solid #f1f3f4; padding-bottom: 8px;">To-Dos</h3>
                        <div>
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <input type="text" id="add-todo-input" placeholder="What needs to be done?" style="flex: 1; padding: 8px; border: 1px solid #dadce0; border-radius: 4px;">
                                <button onclick="addTodo()" style="background: #1a73e8; color: white; border: none; padding: 0 16px; border-radius: 4px; cursor: pointer;">Add</button>
                            </div>
                            <div id="detail-todo-list" style="display: flex; flex-direction: column; gap: 8px;"></div>
                        </div>
                    </div>
                </div>
                <div style="border-top: 1px solid #f1f3f4; padding-top: 32px;">
                    <h3 style="font-size: 18px; margin-bottom: 20px;">Research Log</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px;">
                        <textarea id="add-log-input" rows="3" placeholder="Log new research findings..." style="width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box; font-family: inherit; font-size: 14px;"></textarea>
                        <div style="display: flex; justify-content: flex-end; margin-top: 12px;">
                            <button onclick="addLog()" style="background: #1a73e8; color: white; border: none; padding: 8px 24px; border-radius: 4px; cursor: pointer; font-weight: 500;">Post Log Entry</button>
                        </div>
                    </div>
                    <div id="detail-log-list" style="display: flex; flex-direction: column; gap: 20px;"></div>
                </div>
            </div>
        </div>

        <!-- TABLES TAB -->
        <div id="tab-tables" style="padding: 40px; max-width: 1000px; margin: 0 auto; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                <h2 style="margin: 0; font-size: 28px; font-weight: 400;">Data Tables</h2>
                <button onclick="openNewTableModal()" style="background-color: #1a73e8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: background 0.2s;">
                    + NEW TABLE
                </button>
            </div>
            <div id="table-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <div id="table-empty-state" style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #70757a; background: white; border-radius: 8px; border: 1px dashed #ccc;">
                    No tables documented yet. Add your first data table to begin.
                </div>
            </div>
        </div>

        <!-- TABLE DETAIL VIEW -->
        <div id="tab-table-detail" style="padding: 40px; max-width: 1000px; margin: 0 auto; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <button onclick="showTab('tables')" style="background: none; border: none; color: #1a73e8; cursor: pointer; padding: 0; font-size: 14px; display: flex; align-items: center; font-weight: 500;">
                    ‚Üê Back to Tables
                </button>
                <h1 style="margin: 0; font-size: 18px; color: #5f6368; font-weight: 500;">Table Dictionary</h1>
            </div>
            <div style="background: white; border-radius: 8px; border: 1px solid #e0e0e0; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                <h2 id="table-detail-name" style="margin: 0 0 12px 0; font-size: 32px; font-weight: 400;">Table Name</h2>
                <p id="table-detail-desc" style="color: #5f6368; font-size: 16px; margin-bottom: 32px; line-height: 1.5;"></p>
                
                <h3 style="font-size: 18px; margin: 0 0 16px 0; border-bottom: 2px solid #f1f3f4; padding-bottom: 8px;">Fields Documentation</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr style="text-align: left; background: #f8f9fa;">
                                <th style="padding: 12px; border: 1px solid #e0e0e0; font-size: 13px; color: #5f6368; width: 25%;">Field Name</th>
                                <th style="padding: 12px; border: 1px solid #e0e0e0; font-size: 13px; color: #5f6368; width: 45%;">Description</th>
                                <th style="padding: 12px; border: 1px solid #e0e0e0; font-size: 13px; color: #5f6368; width: 25%;">Example</th>
                                <th style="padding: 12px; border: 1px solid #e0e0e0; width: 40px;"></th>
                            </tr>
                        </thead>
                        <tbody id="field-list-body">
                            <!-- Rows generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- MODAL OVERLAYS -->
    <div id="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center;">
        <!-- Project Modal -->
        <div id="project-modal" style="display:none; background: white; width: 90%; max-width: 700px; max-height: 90vh; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); overflow-y: auto; flex-direction: column;">
            <div style="padding: 24px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 20px;">New Project</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
            </div>
            <div style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 12px; color: #1a73e8; font-weight: 600; margin-bottom: 4px;">PROJECT NAME</label>
                    <input type="text" id="proj-name" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 12px; color: #1a73e8; font-weight: 600; margin-bottom: 4px;">DESCRIPTION</label>
                    <textarea id="proj-desc" rows="3" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box;"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 12px; color: #1a73e8; font-weight: 600; margin-bottom: 4px;">STATUS</label>
                    <select id="proj-status" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; background: white;">
                        <option value="ANA">ANA</option>
                        <option value="DEV">DEV</option>
                        <option value="APB">APB</option>
                        <option value="DONE">Done (DONE)</option>
                    </select>
                </div>
            </div>
            <div style="padding: 16px 24px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeModal()" style="background: none; border: 1px solid #dadce0; color: #5f6368; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Cancel</button>
                <button onclick="saveProject()" style="background: #1a73e8; border: none; color: white; padding: 8px 24px; border-radius: 4px; cursor: pointer;">Create Project</button>
            </div>
        </div>

        <!-- Table Modal -->
        <div id="table-modal" style="display:none; background: white; width: 90%; max-width: 700px; max-height: 90vh; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); overflow-y: auto; flex-direction: column;">
            <div style="padding: 24px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 20px;">New Data Table</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
            </div>
            <div style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 12px; color: #1a73e8; font-weight: 600; margin-bottom: 4px;">TABLE NAME (e.g. USR_PROFILE)</label>
                    <input type="text" id="table-name" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 12px; color: #1a73e8; font-weight: 600; margin-bottom: 4px;">DESCRIPTION</label>
                    <textarea id="table-desc" rows="3" style="width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 4px; box-sizing: border-box;"></textarea>
                </div>
            </div>
            <div style="padding: 16px 24px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeModal()" style="background: none; border: 1px solid #dadce0; color: #5f6368; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Cancel</button>
                <button onclick="saveTable()" style="background: #1a73e8; border: none; color: white; padding: 8px 24px; border-radius: 4px; cursor: pointer;">Add Table</button>
            </div>
        </div>
    </div>

    <script>
        let projects = [];
        let tables = [];
        let currentProjectId = null;
        let currentTableId = null;
        
        const statusColors = {
            'ANA': { bg: '#e8f0fe', text: '#1967d2' },
            'DEV': { bg: '#fef7e0', text: '#ea8600' },
            'APB': { bg: '#fce8e6', text: '#d93025' },
            'DONE': { bg: '#e6f4ea', text: '#1e8e3e' }
        };

        function showTab(tabName) {
            const tabs = ['projects', 'tables', 'project-detail', 'table-detail'];
            tabs.forEach(t => {
                const el = document.getElementById('tab-' + t);
                if (el) el.style.display = (tabName === t) ? 'block' : 'none';
            });

            const navProjects = document.getElementById('nav-projects');
            const navTables = document.getElementById('nav-tables');
            
            navProjects.style.backgroundColor = (tabName === 'projects' || tabName === 'project-detail') ? '#e8f0fe' : 'transparent';
            navProjects.style.color = (tabName === 'projects' || tabName === 'project-detail') ? '#1a73e8' : '#5f6368';
            
            navTables.style.backgroundColor = (tabName === 'tables' || tabName === 'table-detail') ? '#e8f0fe' : 'transparent';
            navTables.style.color = (tabName === 'tables' || tabName === 'table-detail') ? '#1a73e8' : '#5f6368';

            if(tabName === 'projects') renderProjects();
            if(tabName === 'tables') renderTables();
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('project-modal').style.display = 'none';
            document.getElementById('table-modal').style.display = 'none';
            resetForms();
        }

        function resetForms() {
            document.getElementById('proj-name').value = '';
            document.getElementById('proj-desc').value = '';
            document.getElementById('proj-status').value = 'ANA';
            document.getElementById('table-name').value = '';
            document.getElementById('table-desc').value = '';
        }

        // --- PROJECTS LOGIC ---
        function openNewProjectModal() {
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('project-modal').style.display = 'flex';
        }

        function saveProject() {
            const name = document.getElementById('proj-name').value;
            if (!name) return;
            const newProj = {
                id: Date.now(),
                name: name,
                description: document.getElementById('proj-desc').value,
                status: document.getElementById('proj-status').value,
                programs: [],
                tables: [],
                logs: [],
                todos: []
            };
            projects.push(newProj);
            renderProjects();
            closeModal();
        }

        function openProjectDetail(id) {
            currentProjectId = id;
            const project = projects.find(p => p.id === id);
            if (!project) return;
            document.getElementById('detail-name').innerText = project.name;
            document.getElementById('detail-desc-input').value = project.description || "";
            document.getElementById('detail-status-select').value = project.status;
            renderDetailResources();
            renderDetailLogs();
            renderDetailTodos();
            showTab('project-detail');
        }

        function saveDescriptionDirectly(newDesc) {
            const project = projects.find(p => p.id === currentProjectId);
            if (project) project.description = newDesc;
        }

        function updateProjectStatus(newStatus, id = null) {
            const pid = id || currentProjectId;
            const project = projects.find(p => p.id == pid);
            if (project) {
                project.status = newStatus;
                renderProjects();
                if (currentProjectId == pid) {
                    document.getElementById('detail-status-select').value = newStatus;
                }
            }
        }

        function renderDetailResources() {
            const project = projects.find(p => p.id === currentProjectId);
            document.getElementById('detail-programs-list').innerHTML = project.programs.map(p => `<span style="background: #e8f0fe; color: #1a73e8; padding: 4px 10px; border-radius: 4px; font-size: 13px;">${p}</span>`).join('');
            document.getElementById('detail-tables-list').innerHTML = project.tables.map(t => `<span style="background: #f1f3f4; color: #5f6368; padding: 4px 10px; border-radius: 4px; font-size: 13px;">${t}</span>`).join('');
        }

        function addResource(type) {
            const project = projects.find(p => p.id === currentProjectId);
            const inputId = type === 'programs' ? 'add-prog-input' : 'add-table-input';
            const val = document.getElementById(inputId).value.trim();
            if (val) {
                project[type].push(val);
                document.getElementById(inputId).value = '';
                renderDetailResources();
            }
        }

        function renderDetailTodos() {
            const project = projects.find(p => p.id === currentProjectId);
            document.getElementById('detail-todo-list').innerHTML = project.todos.map((t, idx) => `
                <div style="display: flex; align-items: center; gap: 10px; background: #fafafa; padding: 8px 12px; border-radius: 4px; border: 1px solid #eee;">
                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTodo(${project.id}, ${idx})">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                        <span style="font-size: 14px; ${t.done ? 'text-decoration: line-through; color: #999;' : ''}">${t.text}</span>
                        <span style="font-size: 10px; color: #9aa0a6;">Created: ${t.timestamp || 'N/A'}</span>
                    </div>
                </div>
            `).join('');
        }

        function addTodo() {
            const project = projects.find(p => p.id === currentProjectId);
            const text = document.getElementById('add-todo-input').value.trim();
            if (text) {
                const now = new Date();
                const timestamp = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                project.todos.push({ text, done: false, timestamp });
                document.getElementById('add-todo-input').value = '';
                renderDetailTodos();
            }
        }

        function toggleTodo(projId, todoIdx) {
            const project = projects.find(p => p.id == projId);
            if (project) {
                project.todos[todoIdx].done = !project.todos[todoIdx].done;
                if (currentProjectId == projId && document.getElementById('tab-project-detail').style.display === 'block') {
                    renderDetailTodos();
                }
                renderProjects();
            }
        }

        function renderDetailLogs() {
            const project = projects.find(p => p.id === currentProjectId);
            document.getElementById('detail-log-list').innerHTML = project.logs.slice().reverse().map(l => `
                <div style="border-left: 3px solid #1a73e8; padding-left: 16px; margin-bottom: 8px;">
                    <div style="font-size: 11px; color: #9aa0a6; margin-bottom: 4px;">${l.date}</div>
                    <div style="font-size: 14px; line-height: 1.5; color: #202124;">${l.text}</div>
                </div>
            `).join('');
        }

        function addLog() {
            const project = projects.find(p => p.id === currentProjectId);
            const text = document.getElementById('add-log-input').value.trim();
            if (text) {
                project.logs.push({ date: new Date().toLocaleString(), text });
                document.getElementById('add-log-input').value = '';
                renderDetailLogs();
            }
        }

        function renderProjects() {
            const list = document.getElementById('project-list');
            const globalTodoContainer = document.getElementById('global-todos-container');
            const globalTodoList = document.getElementById('global-todo-list');
            const overviewTimestamp = document.getElementById('overview-timestamp');
            const emptyState = document.getElementById('empty-state');
            if (!list) return;
            if (overviewTimestamp) overviewTimestamp.innerText = "Last update: " + new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            let allPendingTodos = [];
            projects.forEach(p => {
                p.todos.forEach((t, idx) => {
                    if (!t.done) allPendingTodos.push({ ...t, projectName: p.name, projId: p.id, todoIdx: idx });
                });
            });
            if (allPendingTodos.length > 0) {
                globalTodoContainer.style.display = 'block';
                globalTodoList.innerHTML = allPendingTodos.map(t => `
                    <div style="background: #fff; border-left: 4px solid #f4b400; padding: 12px 16px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                            <input type="checkbox" onchange="toggleTodo(${t.projId}, ${t.todoIdx})" style="cursor: pointer; width: 16px; height: 16px;">
                            <div style="display: flex; flex-direction: column;">
                                <span style="font-size: 14px; font-weight: 500;">${t.text}</span>
                                <span style="font-size: 10px; color: #9aa0a6;">Added ${t.timestamp || 'recently'}</span>
                            </div>
                        </div>
                        <span style="font-size: 11px; color: #70757a; background: #f1f3f4; padding: 2px 8px; border-radius: 10px; margin-left: 8px;">${t.projectName}</span>
                    </div>
                `).join('');
            } else { globalTodoContainer.style.display = 'none'; }
            if (emptyState) emptyState.style.display = projects.length > 0 ? 'none' : 'block';
            list.innerHTML = '';
            if (projects.length === 0 && emptyState) list.appendChild(emptyState);
            projects.forEach(p => {
                const color = statusColors[p.status];
                const card = document.createElement('div');
                card.style.cssText = `background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; display: flex; flex-direction: column; gap: 12px; cursor: pointer; position: relative;`;
                card.onclick = (e) => {
                    if (e.target.tagName !== 'SELECT' && e.target.type !== 'checkbox' && e.target.tagName !== 'TEXTAREA') openProjectDetail(p.id);
                };
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 4px 0; font-size: 18px;">${p.name}</h3>
                            <p style="margin: 0; font-size: 14px; color: #5f6368; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${p.description || 'No description'}</p>
                        </div>
                        <select onchange="updateProjectStatus(this.value, ${p.id})" style="background-color: ${color.bg}; color: ${color.text}; padding: 4px 8px; border: none; border-radius: 12px; font-size: 11px; font-weight: bold; cursor: pointer; outline: none; margin-left: 10px;">
                            <option value="ANA" ${p.status === 'ANA' ? 'selected' : ''}>ANA</option>
                            <option value="DEV" ${p.status === 'DEV' ? 'selected' : ''}>DEV</option>
                            <option value="APB" ${p.status === 'APB' ? 'selected' : ''}>APB</option>
                            <option value="DONE" ${p.status === 'DONE' ? 'selected' : ''}>DONE</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 24px; font-size: 12px; color: #70757a; border-top: 1px solid #f1f3f4; padding-top: 12px;">
                        <span><strong>Programs:</strong> ${p.programs.length}</span>
                        <span><strong>Tables:</strong> ${p.tables.length}</span>
                        <span><strong>Pending Tasks:</strong> ${p.todos.filter(t => !t.done).length}</span>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // --- TABLES LOGIC ---
        function openNewTableModal() {
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('table-modal').style.display = 'flex';
        }

        function saveTable() {
            const name = document.getElementById('table-name').value.trim();
            if (!name) return;
            const newTable = {
                id: Date.now(),
                name: name,
                description: document.getElementById('table-desc').value,
                fields: []
            };
            tables.push(newTable);
            renderTables();
            closeModal();
        }

        function renderTables() {
            const list = document.getElementById('table-list');
            const emptyState = document.getElementById('table-empty-state');
            if (!list) return;
            if (emptyState) emptyState.style.display = tables.length > 0 ? 'none' : 'block';
            list.innerHTML = '';
            if (tables.length === 0 && emptyState) list.appendChild(emptyState);
            tables.forEach(t => {
                const card = document.createElement('div');
                card.style.cssText = `background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; display: flex; flex-direction: column; gap: 12px;`;
                card.onmouseover = () => card.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                card.onmouseout = () => card.style.boxShadow = 'none';
                card.onclick = () => openTableDetail(t.id);
                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="background: #f1f3f4; padding: 6px; border-radius: 4px; font-size: 18px;">üìÑ</span>
                        <h3 style="margin: 0; font-size: 18px; color: #1a73e8;">${t.name}</h3>
                    </div>
                    <p style="margin: 0; font-size: 14px; color: #5f6368; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${t.description || 'No description provided.'}</p>
                    <div style="margin-top: auto; font-size: 12px; color: #9aa0a6;">
                        ${t.fields.length} fields documented
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function openTableDetail(id) {
            currentTableId = id;
            const table = tables.find(t => t.id === id);
            if (!table) return;
            document.getElementById('table-detail-name').innerText = table.name;
            document.getElementById('table-detail-desc').innerText = table.description;
            renderFields();
            showTab('table-detail');
        }

        function renderFields() {
            const table = tables.find(t => t.id === currentTableId);
            const tbody = document.getElementById('field-list-body');
            tbody.innerHTML = '';
            
            table.fields.forEach((f, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding: 0; border: 1px solid #e0e0e0;">
                        <input type="text" value="${f.name}" onchange="updateField(${idx}, 'name', this.value)" style="width: 100%; border: none; padding: 12px; box-sizing: border-box; font-family: inherit; font-size: 13px;" placeholder="Name...">
                    </td>
                    <td style="padding: 0; border: 1px solid #e0e0e0;">
                        <input type="text" value="${f.description}" onchange="updateField(${idx}, 'description', this.value)" style="width: 100%; border: none; padding: 12px; box-sizing: border-box; font-family: inherit; font-size: 13px;" placeholder="What is this field?">
                    </td>
                    <td style="padding: 0; border: 1px solid #e0e0e0;">
                        <input type="text" value="${f.example}" onchange="updateField(${idx}, 'example', this.value)" style="width: 100%; border: none; padding: 12px; box-sizing: border-box; font-family: inherit; font-size: 13px;" placeholder="e.g. 12345">
                    </td>
                    <td style="padding: 0; border: 1px solid #e0e0e0; text-align: center; background: #fff;">
                        <button onclick="removeField(${idx})" style="border: none; background: none; color: #d93025; cursor: pointer; padding: 8px; font-size: 16px;">&times;</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            const autoRow = document.createElement('tr');
            autoRow.innerHTML = `
                <td style="padding: 0; border: 1px solid #e0e0e0;">
                    <input type="text" id="new-field-name" 
                        onkeydown="if(event.key === 'Enter') handleFieldAdd(this)" 
                        onblur="handleFieldAdd(this)"
                        style="width: 100%; border: none; padding: 12px; box-sizing: border-box; font-family: inherit; font-size: 13px; background: #fffbe6;" 
                        placeholder="Type field name and press Enter...">
                </td>
                <td style="padding: 0; border: 1px solid #e0e0e0; background: #fffbe6;"><div style="padding: 12px; color: #ccc; font-size: 13px;">...</div></td>
                <td style="padding: 0; border: 1px solid #e0e0e0; background: #fffbe6;"><div style="padding: 12px; color: #ccc; font-size: 13px;">...</div></td>
                <td style="padding: 0; border: 1px solid #e0e0e0; background: #fffbe6;"></td>
            `;
            tbody.appendChild(autoRow);
        }

        function handleFieldAdd(input) {
            const val = input.value.trim();
            if (val.length > 0) {
                const table = tables.find(t => t.id === currentTableId);
                table.fields.push({ name: val, description: '', example: '' });
                input.value = ''; // Clear input before re-render
                renderFields();
                // Find the inputs in the newly rendered table
                const rows = document.querySelectorAll('#field-list-body tr');
                if (rows.length > 1) {
                    // Focus the description input of the row we just added (the last one before the auto-row)
                    const lastDataRow = rows[rows.length - 2];
                    const inputs = lastDataRow.querySelectorAll('input');
                    if (inputs.length > 1) inputs[1].focus(); 
                }
            }
        }

        function updateField(idx, key, val) {
            const table = tables.find(t => t.id === currentTableId);
            if (table && table.fields[idx]) {
                table.fields[idx][key] = val;
            }
        }

        function removeField(idx) {
            const table = tables.find(t => t.id === currentTableId);
            if (table) {
                table.fields.splice(idx, 1);
                renderFields();
            }
        }

        window.onload = () => {
            showTab('projects');
        };
    </script>
</body>
</html>
